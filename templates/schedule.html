{% extends "base.html" %}
{% block title %}Race Schedule | Uma Ladder{% endblock %}

{% block content %}
<h2 class="mb-4">ðŸ“… Upcoming Races</h2>

{% if upcoming_races %}
<table class="table table-bordered table-hover table-sm align-middle">
  <thead class="table-dark text-center">
    <tr>
      <th>#</th>
      <th>Season</th>
      <th>Week</th>
      <th>Type</th>
      <th>Race Name</th>
      <th>Grade</th>
      <th>Event</th>
      <th>Distance</th>
      <th>Location</th>
      <th>Surface</th>
      <th>Direction</th>
      <th>Mood</th>
      <th>Weather</th>
      <th>P. Count</th>
      <th class="text-center">Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for race in upcoming_races %}
    <tr class="text-center">
      <td>{{ race.race_number }}</td>
      <td>{{ race.season }}</td>
      <td>{{ race.week }}</td>

      <td class="{% if race.race_type == 'Sprint' %}bg-type-sprint
                  {% elif race.race_type == 'Mile' %}bg-type-mile
                  {% elif race.race_type == 'Medium' %}bg-type-medium
                  {% elif race.race_type == 'Long' %}bg-type-long{% endif %}">
        {{ race.race_type }}
      </td>

      <td class="text-start">{{ race.race_name }}</td>

      <td class="{% if race.grade == 'G1' %}bg-grade-g1 fw-bold{% endif %}">{{ race.grade }}</td>
      <td>{{ race.event_type }}</td>
      <td>{{ race.distance }}</td>
      <td>{{ race.location }}</td>

      <td class="{% if race.surface == 'Turf' %}bg-surface-turf
                  {% elif race.surface == 'Dirt' %}bg-surface-dirt{% endif %}">
        {{ race.surface }}
      </td>

      <td>{{ race.direction }}</td>

      <td class="{% if race.mood in ['Great', 'Good'] %}bg-mood-good
                  {% elif race.mood in ['Bad', 'Awful'] %}bg-mood-bad{% endif %}">
        {{ race.mood }}
      </td>

      <td>{{ race.weather }}</td>
      <td>{{ race.participant_count }}</td>

      <td>
        <div class="d-flex gap-1 justify-content-center flex-wrap">
          {% if current_user.is_authenticated and current_user.is_admin %}
            <a href="{{ url_for('edit_race', race_id=race.id) }}" class="btn btn-sm btn-outline-secondary">Edit</a>
          {% endif %}

          <a href="{{ url_for('race_results', race_id=race.id) }}" class="btn btn-sm btn-outline-info">Results</a>

          {% if current_user.is_authenticated and current_user.is_admin and not race.completed %}
            <form method="POST" action="{{ url_for('mark_race_completed', race_id=race.id) }}">
              <button type="submit" class="btn btn-sm btn-outline-success" title="Mark Completed">âœ”</button>
            </form>
          {% endif %}
        </div>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p>No upcoming races.</p>
{% endif %}

<hr class="my-5">

<h2 class="mb-4">ðŸ“‚ Completed Races</h2>

{% if completed_races %}
<table class="table table-bordered table-hover table-sm align-middle">
  <thead class="table-dark text-center">
    <tr>
      <th>#</th>
      <th>Season</th>
      <th>Week</th>
      <th>Type</th>
      <th>Race Name</th>
      <th>Grade</th>
      <th>Event</th>
      <th>Distance</th>
      <th>Location</th>
      <th>Surface</th>
      <th>Direction</th>
      <th>Mood</th>
      <th>Weather</th>
      <th>P. Count</th>
      <th class="text-center">Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for race in completed_races %}
    <tr class="text-center">
      <td>{{ race.race_number }}</td>
      <td>{{ race.season }}</td>
      <td>{{ race.week }}</td>

      <td class="{% if race.race_type == 'Sprint' %}bg-type-sprint
                  {% elif race.race_type == 'Mile' %}bg-type-mile
                  {% elif race.race_type == 'Medium' %}bg-type-medium
                  {% elif race.race_type == 'Long' %}bg-type-long{% endif %}">
        {{ race.race_type }}
      </td>

      <td class="text-start">{{ race.race_name }}</td>

      <td class="{% if race.grade == 'G1' %}bg-grade-g1 fw-bold{% endif %}">{{ race.grade }}</td>
      <td>{{ race.event_type }}</td>
      <td>{{ race.distance }}</td>
      <td>{{ race.location }}</td>

      <td class="{% if race.surface == 'Turf' %}bg-surface-turf
                  {% elif race.surface == 'Dirt' %}bg-surface-dirt{% endif %}">
        {{ race.surface }}
      </td>

      <td>{{ race.direction }}</td>

      <td class="{% if race.mood in ['Great', 'Good'] %}bg-mood-good
                  {% elif race.mood in ['Bad', 'Awful'] %}bg-mood-bad{% endif %}">
        {{ race.mood }}
      </td>

      <td>{{ race.weather }}</td>
      <td>{{ race.participant_count }}</td>

      <td>
        <div class="d-flex gap-1 justify-content-center flex-wrap">
          {% if current_user.is_authenticated and current_user.is_admin %}
            <a href="{{ url_for('edit_race', race_id=race.id) }}" class="btn btn-sm btn-outline-secondary">Edit</a>
          {% endif %}
          <a href="{{ url_for('race_results', race_id=race.id) }}" class="btn btn-sm btn-outline-info">Results</a>
        </div>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p>No completed races yet.</p>
{% endif %}

<a href="{{ url_for('add_race') }}" class="btn btn-primary mt-4">âž• Add New Race</a>
{% endblock %}
